<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Referral 5 Kode Khusus</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        .box { border: 1px solid #ddd; padding: 10px; margin: 10px; display: inline-block; width: 300px; }
        input, select { width: 80%; padding: 5px; margin-top: 5px; text-align: center; }
        button { margin-top: 5px; cursor: pointer; padding: 5px 10px; }
    </style>
</head>
<body>
    <h2>Sistem Referral 5 Kode Khusus</h2>

    <!-- Pilih referral -->
    <div class="box">
        <h3>Informasi Referral</h3>
        <p id="info-reff">Memeriksa referral...</p>
        <p id="owner-info">Pemilik referral: -</p>
        <select id="reff-selection">
            <option value="">Pilih Referral</option>
            <option value="reff1">reff1</option>
            <option value="reff2">reff2</option>
            <option value="reff3">reff3</option>
            <option value="reff4">reff4</option>
            <option value="reff5">reff5</option>
        </select>
        <button id="setOwner">Jadikan Saya Pemilik</button>
    </div>

    <!-- Link Referral -->
    <div class="box">
        <h3>Link Referral Anda</h3>
        <input type="text" id="ref-link" readonly>
        <button onclick="copyReferral()">Salin Link</button>
    </div>

    <!-- Statistik -->
    <div class="box">
        <h3>Statistik Anda</h3>
        <p id="watch-count">Jumlah tontonan iklan: 0</p>
        <p id="main-balance">Saldo utama: Rp0</p>
        <p id="reff-balance">Saldo referral: Rp0</p>
        <p id="reff-members">Anggota referral: 0</p>
    </div>

    <button id="watchAd">Tonton Iklan</button>

    <script>
        function getURLParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        window.onload = function() {
            let referralFromURL = getURLParameter("reff");
            if (referralFromURL && !localStorage.getItem("userReferral")) {
                localStorage.setItem("userReferral", referralFromURL);

                let referralData = JSON.parse(localStorage.getItem("referralData")) || {};
                if (!referralData[referralFromURL]) {
                    referralData[referralFromURL] = { saldo: 0, anggota: [] };
                }
                
                let userID = "user_" + Math.floor(Math.random() * 100000);
                if (!referralData[referralFromURL].anggota.includes(userID)) {
                    referralData[referralFromURL].anggota.push(userID);
                    localStorage.setItem("userID", userID);
                    alert(`Selamat! Anda resmi menjadi anggota referral ${referralFromURL}.`);
                }
                
                localStorage.setItem("referralData", JSON.stringify(referralData));
            }
            updateUI();
        };

        let availableRefs = ["reff1", "reff2", "reff3", "reff4", "reff5"];
        let ownerPassword = "12345"; 
        let referralBonus = 2;

        let userBalance = parseInt(localStorage.getItem("userBalance")) || 0;
        let watchCount = parseInt(localStorage.getItem("watchCount")) || 0;
        let referralData = JSON.parse(localStorage.getItem("referralData")) || {};

        function updateUI() {
            document.getElementById("watch-count").innerText = `Jumlah tontonan iklan: ${watchCount}`;
            document.getElementById("main-balance").innerText = `Saldo utama: Rp${userBalance}`;

            let owner = localStorage.getItem("refOwner");
            let userReferral = localStorage.getItem("userReferral");
            let reffBalance = referralData[owner]?.saldo || 0;
            let reffMembers = referralData[owner]?.anggota.length || 0;

            if (owner) {
                document.getElementById("owner-info").innerText = `Pemilik referral: ${owner}`;
                document.getElementById("setOwner").style.display = "none";
                document.getElementById("ref-link").value = `https://t.me/Rcbtv2_bot?reff=${owner}`;
            } else {
                document.getElementById("owner-info").innerText = "Pemilik referral: Belum ada";
                document.getElementById("ref-link").value = "Belum ada pemilik referral";
            }

            if (userReferral === owner) {
                document.getElementById("info-reff").innerText = `Anda adalah pemilik referral: ${owner}`;
            } else if (userReferral) {
                document.getElementById("info-reff").innerText = `Anda bergabung di bawah referral: ${userReferral}`;
            } else {
                document.getElementById("info-reff").innerText = "Anda belum memilih referral.";
            }

            document.getElementById("reff-balance").innerText = `Saldo referral: Rp${reffBalance}`;
            document.getElementById("reff-members").innerText = `Anggota referral: ${reffMembers}`;
        }

        document.getElementById("setOwner").addEventListener("click", function() {
            if (!localStorage.getItem("refOwner")) {
                let inputPass = prompt("Masukkan sandi pemilik referral:");
                if (inputPass === ownerPassword) {
                    let chosenRef = document.getElementById("reff-selection").value;

                    if (availableRefs.includes(chosenRef)) {
                        localStorage.setItem("refOwner", chosenRef);
                        localStorage.setItem("userReferral", chosenRef);

                        referralData[chosenRef] = { saldo: 0, anggota: [] };
                        localStorage.setItem("referralData", JSON.stringify(referralData));

                        alert(`Anda sekarang adalah pemilik referral ${chosenRef}!`);
                        updateUI();
                    } else {
                        alert("Referral tidak tersedia!");
                    }
                } else {
                    alert("Sandi salah!");
                }
            } else {
                alert("Anda sudah memiliki referral!");
            }
        });

        document.getElementById("watchAd").addEventListener("click", function() {
            userBalance += 14;
            watchCount++;
            localStorage.setItem("userBalance", userBalance);
            localStorage.setItem("watchCount", watchCount);

            let userReferral = localStorage.getItem("userReferral");
            if (userReferral && referralData[userReferral]) {
                referralData[userReferral].saldo += referralBonus;
                localStorage.setItem("referralData", JSON.stringify(referralData));
            }

            updateUI();
            alert("Anda mendapatkan Rp14 dari iklan!");
        });

        function copyReferral() {
            let refInput = document.getElementById("ref-link");
            refInput.select();
            document.execCommand("copy");
            alert("Link referral disalin!");
        }

        updateUI();
    </script>
</body>
</html>