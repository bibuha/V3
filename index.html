<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Referral + Iklan</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #watchAd { padding: 10px 20px; font-size: 16px; margin-top: 10px; cursor: pointer; }
        .box { border: 1px solid #ddd; padding: 10px; margin: 10px; display: inline-block; }
    </style>
</head>
<body>
    <h2>Sistem Referral + Bonus</h2>

    <div class="box">
        <h3>Informasi Referral</h3>
        <p id="info-reff">Memeriksa referral...</p>
    </div>

    <div class="box">
        <h3>Statistik Anda</h3>
        <p id="watch-count">Jumlah tontonan iklan: 0</p>
        <p id="main-balance">Saldo utama: Rp0</p>
        <p id="reff-balance">Saldo referral: Rp0</p>
    </div>

    <button id="watchAd">Tonton Iklan</button>

    <script>
        let referralList = ["reff1", "reff2", "reff3", "reff4", "reff5"];
        let referralOwners = JSON.parse(localStorage.getItem("refOwners")) || {};
        let referralMembers = JSON.parse(localStorage.getItem("refMembers")) || {};
        let referrerBalance = JSON.parse(localStorage.getItem("referrerBalance")) || {};
        let userReferral = localStorage.getItem("userReferral");
        let userBalance = parseInt(localStorage.getItem("userBalance")) || 0;
        let watchCount = parseInt(localStorage.getItem("watchCount")) || 0;

        const params = new URLSearchParams(window.location.search);
        const refCode = params.get("reff");

        let userID = localStorage.getItem("userID");
        if (!userID) {
            userID = "user-" + Math.floor(Math.random() * 100000);
            localStorage.setItem("userID", userID);
        }

        function updateUI() {
            document.getElementById("watch-count").innerText = `Jumlah tontonan iklan: ${watchCount}`;
            document.getElementById("main-balance").innerText = `Saldo utama: Rp${userBalance}`;
            document.getElementById("reff-balance").innerText = `Saldo referral: Rp${referrerBalance[userID] || 0}`;

            if (userReferral && userReferral !== "Tanpa Referral") {
                document.getElementById("info-reff").innerText = `Anda terdaftar di referral: ${userReferral}`;
            } else {
                document.getElementById("info-reff").innerText = "Anda bergabung tanpa referral.";
            }
        }

        if (!userReferral) {
            if (refCode && referralList.includes(refCode)) {
                if (!referralOwners[refCode]) {
                    referralOwners[refCode] = userID;
                    localStorage.setItem("userReferral", refCode);
                    localStorage.setItem("refOwners", JSON.stringify(referralOwners));
                    document.getElementById("info-reff").innerText = `Anda menjadi pemilik referral: ${refCode}`;
                } else {
                    localStorage.setItem("userReferral", refCode);
                    if (!referralMembers[refCode]) {
                        referralMembers[refCode] = [];
                    }
                    referralMembers[refCode].push(userID);
                    localStorage.setItem("refMembers", JSON.stringify(referralMembers));
                    document.getElementById("info-reff").innerText = `Anda bergabung di bawah referral: ${refCode}`;
                }
            } else {
                localStorage.setItem("userReferral", "Tanpa Referral");
                document.getElementById("info-reff").innerText = "Anda bergabung tanpa referral.";
            }
        }

        document.getElementById("watchAd").addEventListener("click", function() {
            userBalance += 14;
            watchCount++;
            localStorage.setItem("userBalance", userBalance);
            localStorage.setItem("watchCount", watchCount);

            if (userReferral && userReferral !== "Tanpa Referral") {
                let refOwnerID = referralOwners[userReferral];
                if (refOwnerID && refOwnerID !== userID) {
                    if (!referrerBalance[refOwnerID]) {
                        referrerBalance[refOwnerID] = 0;
                    }
                    referrerBalance[refOwnerID] += 1;
                    localStorage.setItem("referrerBalance", JSON.stringify(referrerBalance));
                }
            }

            updateUI();
            alert("Anda mendapatkan Rp14 dari iklan!");
        });

        updateUI();
    </script>
</body>
</html>